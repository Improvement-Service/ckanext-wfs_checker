!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var o=n(1),i=n(2),l=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url="",this.is_file=!0,this.service_type=null}var t,n,l;return t=e,(n=[{key:"set_url",value:function(e){this.url=e}},{key:"set_is_file",value:function(e){this.is_file=e}},{key:"set_service_type",value:function(e){this.service_type=e}},{key:"get_url",value:function(){return this.url}},{key:"get_is_file",value:function(){return this.is_file}},{key:"get_service_type",value:function(){return this.service_type}},{key:"set_up",value:function(){i.set_up_all_listeners()}},{key:"checkValues",value:function(){for(var e=[document.getElementById("field-image-url"),document.getElementById("layer_name_dropdown"),document.getElementById("field-name"),document.getElementById("resource-uploader_name"),document.getElementById("resource-department_name"),document.getElementById("digit_background"),document.getElementById("resource-data_processor"),document.getElementById("field-description"),document.getElementById("service_type")],t=[],n=0;n<e.length;n++){var r=e[n];("null"==r.value||r.value.length<1)&&("service_type"==r.name&&1==is_file||t.push(r.name))}t.length>0?"layer_name"==t.join()?this.formSubmit():"wfs"==this.service_type||"rest"==this.service_type?(o.createErrorNotification(t),document.body.scrollTop=document.documentElement.scrollTop=0):(t=t.filter((function(e){return"layer_name"!==e})),o.createErrorNotification(t),document.body.scrollTop=document.documentElement.scrollTop=0):this.formSubmit()}},{key:"formSubmit",value:function(){document.getElementById("saveBtn")?$("#saveBtn").click():$("#submitBtn").click()}}])&&r(t.prototype,n),l&&r(t,l),e}());t.default=l,$(document).ready((function(){setTimeout(l.set_up,600)}))},function(e,t,n){"use strict";function r(e,t){document.getElementById(e).value=t}function o(){$("#service_type_info_box_1").css("display","none")}function i(){$("#service_type_info_box_1").css("display","block")}function l(){$("#layer_name_info_block").html("".concat('<i class="fa fa-info-circle"></i>'," ").concat("You can use a valid ESRI rest MapServer, Group Layer or Feature Layer.\n    If you need to supply multiple layers from this ESRI rest service, please load them individually (as separate resources).\n    "))}function a(){$("#layer_name_info_block").html("".concat('<i class="fa fa-info-circle"></i>'," ").concat("If you need to supply multiple layers from this WFS, please load them individually (as\n    separate resources)."))}function u(){$("#service_type_group").css("display","none")}function s(){$("#service_type_group").css("display","block")}function c(){document.getElementById("get_layers_btn").disabled=!0}function _(){document.getElementById("get_layers_btn").disabled=!1}function d(){$("#layer_name_dropdown").css("display","none")}function f(){$("#layer_name_dropdown").css("display","inline-block")}function y(){$("#layer_selector").css("display","inline-block")}function p(){$("#layer_selector").css("display","none")}function v(){document.body.style.cursor="progress"}function m(){document.body.style.cursor="auto"}function h(){$("#layer_name_dropdown option").remove(),$("#layer_name_dropdown").append($("<option>",{value:"null",text:"Loading..."}))}function b(){$("#layer_name_dropdown option").remove(),$("#layer_name_dropdown").append($("<option>",{value:"null",text:"No Layers Available, Please Try Again."}))}function g(){$("#layer_name_dropdown option").remove(),$("#layer_name_dropdown").append($("<option>",{value:"null",text:'Click "Get Layers" Button To Populate Dropdown.'}))}function k(e){if($("#layer_name_dropdown").empty(),e.length<1)return b(),null;if(e.length>1){$("<option value=>Please Select Layer</option>").appendTo("#layer_name_dropdown")}$.each(e,(function(e,t){var n="<option value="+t.value+">"+t.text+"</option>";$(n).appendTo("#layer_name_dropdown")}))}function w(e){document.getElementById(e)&&document.getElementById(e).remove()}function E(e){w("attribute-errors-div");var t=document.createElement("div");t.id="attribute-errors-div",t.className="error-explanation alert alert-error";var n=document.createElement("p");n.innerHTML="Missing Attributes:";for(var r=document.createElement("ul"),o=0;o<e.length;o++){var i=document.createElement("li");i.innerHTML="".concat(e[o]," is missing."),r.append(i)}n.append(r),t.append(n),document.getElementById("resource-edit").prepend(t)}n.r(t),n.d(t,"selectElement",(function(){return r})),n.d(t,"service_type_info_box_hidden",(function(){return o})),n.d(t,"service_type_info_box_block",(function(){return i})),n.d(t,"layer_name_info_box_esri_rest_content",(function(){return l})),n.d(t,"layer_name_info_box_wfs_content",(function(){return a})),n.d(t,"service_type_display_none",(function(){return u})),n.d(t,"service_type_display_block",(function(){return s})),n.d(t,"disable_get_layer_btn",(function(){return c})),n.d(t,"enable_get_layer_btn",(function(){return _})),n.d(t,"layer_dropdown_disable",(function(){return d})),n.d(t,"layer_dropdown_enable",(function(){return f})),n.d(t,"layer_selector_enable",(function(){return y})),n.d(t,"layer_selector_disable",(function(){return p})),n.d(t,"CursorLoading",(function(){return v})),n.d(t,"CursorAuto",(function(){return m})),n.d(t,"handle_loading",(function(){return h})),n.d(t,"handle_request_fail",(function(){return b})),n.d(t,"reset_layer_dropdown",(function(){return g})),n.d(t,"add_to_drop_down",(function(){return k})),n.d(t,"removeDivIfExists",(function(){return w})),n.d(t,"createErrorNotification",(function(){return E}))},function(e,t,n){"use strict";n.r(t),n.d(t,"link_btn_listener",(function(){return u})),n.d(t,"remove_link_btn_listener",(function(){return s})),n.d(t,"service_selector_listener",(function(){return c})),n.d(t,"get_layers_btn_listener",(function(){return _})),n.d(t,"submit_btn_listener",(function(){return d})),n.d(t,"set_up_all_listeners",(function(){return f}));var r=n(1),o=n(0),i=n(3),l=n(4),a=n(5);function u(e){document.getElementsByClassName("controls ")[1].childNodes[3].onclick=function(){r.service_type_display_block(),e.set_is_file(!1)}}function s(e){document.getElementsByClassName("btn btn-danger btn-remove-url")[0].onclick=function(){r.service_type_display_none(),r.layer_selector_disable(),r.selectElement("service_type","null"),r.reset_layer_dropdown(),e.set_is_file(!0)}}function c(e){$("#service_type").change((function(){var t=$(this).val();r.reset_layer_dropdown(),"wfs"==t?(e.set_service_type("wfs"),r.enable_get_layer_btn(),r.layer_selector_enable(),r.service_type_info_box_block(),r.layer_name_info_box_wfs_content()):"rest"==t?(e.set_service_type("rest"),r.enable_get_layer_btn(),r.layer_selector_enable(),r.service_type_info_box_block(),r.layer_name_info_box_esri_rest_content()):"other"==t?(e.set_service_type("other"),r.disable_get_layer_btn(),r.layer_selector_disable(),r.service_type_info_box_hidden()):(e.set_service_type(null),r.disable_get_layer_btn(),r.layer_selector_disable(),r.service_type_info_box_hidden())}))}function _(e){$("#get_layers_btn").click((function(){var t=$("#field-image-url").val();if(""!=t&&a(t))if("wfs"==e.get_service_type()&&0==e.get_is_file())r.CursorLoading(),new i.WFS_getter(t).get_layers();else if("rest"==e.get_service_type()&&0==e.get_is_file()){r.CursorLoading(),new l.WFS_getter(t).get_layers()}else console.log("this should not happen...");else alert("Please Supply a valid url")}))}function d(e){$("#checkBtn").click((function(){e.checkValues()}))}function f(){var e=o.default;u(e),s(e),u(e),c(e),_(e),d(e)}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"WFS_getter",(function(){return l}));var o=n(0),i=n(1),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.webserviceChecker=o.default}var t,n,l;return t=e,(n=[{key:"cleanUrl",value:function(e){e=decodeURIComponent(String(e));var t=null;for(var n in tokens=["authkey","id","key","token","authentication"],tokens)test_on(e,tokens[n])&&null==t&&(t=match_on(e,tokens[n])[0]);return e.includes("?")&&(e=e.split("?")[0]),e+="?request=getcapabilities&service=wfs",null!=t&&(e=e+"&"+t),e}},{key:"getCurrentURLPath",value:function(){return window.location.href.split("/").splice(0,3).join("/")}},{key:"handleResponse",value:function(e){return e.json().then((function(t){if(!e.ok){var n=Object.assign({},t,{status:e.status,statusText:e.statusText});return Promise.reject(n)}return t}))}},{key:"create_options",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=new Object;r.text=e[n].name,r.value=e[n].name,t.push(r)}return t}},{key:"get_layers",value:function(){var e=this;i.handle_loading();var t=$("#field-image-url").val().trim(),n="".concat(this.getCurrentURLPath(),"/api/3/action/get_wfs_layers"),r={url:this.cleanUrl(t)},o=new FormData;o.append("json",JSON.stringify(r)),fetch(n,{method:"POST",body:o}).then(this.handleResponse).then((function(t){if(t.status_code=200){if(t.result.error)throw console.error(t.result.error),i.handle_request_fail(),t.result.error;var n=e.create_options(t.result);i.add_to_drop_down(n)}else alert("Unable to retrieve layers from WFS please continue"),console.error("Request Failed"),i.handle_request_fail()})).catch((function(e){console.warn(e),i.handle_request_fail()})).finally((function(){i.CursorAuto()}))}},{key:"matchRuleShort",value:function(e,t){return new RegExp("^"+t.split("*").map((function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")})).join(".*")+"$").test(e)}},{key:"match_on",value:function(e,t){return RegExp("(".concat(t,'=([a-z-A-Z-0-9_"£$%*^~])+)')).exec(e)}},{key:"test_on",value:function(e,t){return RegExp("(".concat(t,'=([a-z-A-Z-0-9_"£$%*^~])+)')).test(e)}},{key:"cleanUrl",value:function(e){e=decodeURIComponent(String(e));var t=null,n=["authkey","id","key","token","authentication"];for(var r in n)this.test_on(e,n[r])&&null==t&&(t=this.match_on(e,n[r])[0]);return e.includes("?")&&(e=e.split("?")[0]),e+="?request=getcapabilities&service=wfs",null!=t&&(e=e+"&"+t),e}}])&&r(t.prototype,n),l&&r(t,l),e}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"WFS_getter",(function(){return l}));var o=n(0),i=n(1),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.webserviceChecker=o.default}var t,n,l;return t=e,(n=[{key:"getCurrentURLPath",value:function(){return window.location.href.split("/").splice(0,3).join("/")}},{key:"handleResponse",value:function(e){return e.json().then((function(t){if(!e.ok){var n=Object.assign({},t,{status:e.status,statusText:e.statusText});return Promise.reject(n)}return t}))}},{key:"create_options",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=new Object;r.text=e[n].name,r.value=e[n].url,t.push(r)}return t}},{key:"get_layers",value:function(){var e=this;i.handle_loading();var t=$("#field-image-url").val().trim(),n="".concat(this.getCurrentURLPath(),"/api/3/action/get_esri_rest_layers"),r={url:t},o=new FormData;o.append("json",JSON.stringify(r)),fetch(n,{method:"POST",body:o}).then(this.handleResponse).then((function(t){if(t.status_code=200){if(t.result.error)throw console.error(t.result.error),i.handle_request_fail(),t.result.error;var n=e.create_options(t.result);i.add_to_drop_down(n)}else alert("Unable to retrieve layers from esri rest service please use a valid url"),console.error("Request Failed"),i.handle_request_fail()})).catch((function(e){console.warn(e),i.handle_request_fail()})).finally((function(){i.CursorAuto()}))}}])&&r(t.prototype,n),l&&r(t,l),e}()},function(e,t){e.exports=function(e){if("string"!=typeof e)return!1;var t=e.match(n);if(!t)return!1;var i=t[1];if(!i)return!1;if(r.test(i)||o.test(i))return!0;return!1};var n=/^(?:\w+:)?\/\/(\S+)$/,r=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,o=/^[^\s\.]+\.\S{2,}$/}]);